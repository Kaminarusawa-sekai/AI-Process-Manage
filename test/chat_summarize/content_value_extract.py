import langchain
from langchain_openai import AzureChatOpenAI
from langchain_core.prompts import PromptTemplate
from langchain.chains import LLMChain


import configparser

# 创建ConfigParser对象
config = configparser.ConfigParser()

# 读取配置文件
config.read('config.ini')

# 获取llm的配置参数

# EMBEDDING_URL = config.get('Azurellm','EMBEDDING_URL')
EMBEDDING_URL ="https://aichatlanba.openai.azure.com/openai/deployments/text-embedding-3-large/embeddings?api-version=2023-05-15"
OPENAI_API_KEY = "d4259c15567e44809c9629fae89583f8"
OPENAI_API_TYPE = "azure"
OPENAI_API_VERSION = "2023-03-15-preview"
AZURE_ENDPOINT="https://aichatlanba.openai.azure.com/"
# OPENAI_API_KEY = config.get('Azurellm','OPENAI_API_KEY')
# OPENAI_API_TYPE = config.get('Azurellm','OPENAI_API_TYPE')
# OPENAI_API_VERSION = config.get('Azurellm','OPENAI_API_VERSION')
# AZURE_ENDPOINT=config.get('Azurellm','AZURE_ENDPOINT')

print(EMBEDDING_URL)



# 定义一个更详细的提示模板
template = """
## 角色
你是一位专业的商业机会分析师，擅长从各种对话和交流中挖掘潜在的商业机会。你的任务是帮助用户识别对话中提到的可能与公司业务相关的商机，并评估这些机会的价值和可行性。
### Skill

商机识别：准确识别对话中提及的任何可能与公司业务相关的商业机会。
价值评估：分析每个商机的潜在价值，包括市场潜力、收益预期等。
可行性分析：评估实现每个商机所需的资源、时间和风险，判断其可行性。
关联性确认：确认商机与公司现有业务或战略目标的相关性。
报告生成：生成详细的商机分析报告，提供具体的行动建议。

## Rules

保持专业：在分析过程中保持专业和客观的态度。
不改变意思：确保总结的内容忠实于原始对话的核心意思。
提取关键信息：找到关键的商机线索和支持这些商机的观点及依据。
直接输出：直接提供总结文本，无需额外的寒暄或解释。
字数要求：根据实际需要生成适当长度的总结文本，不必刻意达到特定字数。

## Workflow

用户提供一段包含讨论内容的对话文本，其中可能涉及多种观点和信息。
你将分析这段对话，识别所有可能与公司业务相关的商机。
对每个识别出的商机进行详细的价值和可行性分析。
确认这些商机与公司现有业务或战略目标的相关性。
根据分析结果，生成一份详细的商机分析报告，包括具体行动建议。

## Company_operations
这里是给公司经营范围的参考
{company_operations}

## Initialization

作为专业的商业机会分析师，让我们有条不紊地进行工作。遵循上述规则，在简体中文环境下与用户交流。在聊天过程中，你将始终扮演此角色并根据设定进行工作，不跳脱角色。你需要：

识别商机：从对话中找出所有可能与公司业务相关的商机。
评估价值：分析每个商机的潜在市场潜力和收益预期。
分析可行性：评估实现每个商机所需的资源、时间和风险。
确认关联性：确保商机与公司现有业务或战略目标紧密相关。
生成报告：提供一份清晰、准确的商机分析报告，说明每个商机的具体情况及其对公司的潜在影响，并提出具体的行动建议。
需要你提炼的文字如下:
{user_input}



"""

# 创建一个提示模板对象
prompt = PromptTemplate(template=template, input_variables=["user_input,company_operations"])

# 初始化语言模型
llm = AzureChatOpenAI(azure_endpoint=AZURE_ENDPOINT,
                          openai_api_version=OPENAI_API_VERSION,
                          openai_api_key=OPENAI_API_KEY,
                          azure_deployment="gpt-4o",
                          openai_api_type=OPENAI_API_TYPE,
                          streaming=True,
                          temperature=0.7)

# 创建一个链
chain = prompt|llm

def get_job_details(input):
    # 使用链来获取响应"https://aichatlanba.openai.azure.com/openai/deployments/text-embedding-3-large/embeddings?api-version=2023-05-15"
    response = chain.invoke(input).content
    
    
    return response

# 用户输入示例
user_input = '''
在这段对话中，甲方可胜和乙方冰茶之间的交流主要围绕着一个技术问题展开，即可胜在使用云端备份服务时遇到的问题。以下是对话中各个角色的主要观点和依据，以及总结后的文本：

### 甲方：可胜
**角色及影响力**：
甲方可胜是云端备份服务的用户，作为客户，在整个对话中主要的作用是提出问题并寻求解决方案。由于他的反馈直接关系到服务质量，具有一定的影响力。

**主要观点及依据**：
1. **问题描述**：
   - **具体问题**：在尝试恢复上周备份的数据时，系统提示找不到备份文件。
   - **错误信息**：提供了具体的错误信息“ERR-012: Backup not found”和备份任务ID BCK-123456789。
2. **确认信息**：
   - **时间和日期**：已检查时间和日期，确认无误。
   - **账户使用情况**：确认只有自己在使用该账户，没有其他设备连接同一备份任务。
3. **关切**：
   - **数据恢复**：希望数据能尽快恢复。
   - **未来问题**：担心未来会再次遇到类似问题。

### 乙方：冰茶
**角色及影响力**：
乙方冰茶是云端备份服务的客服代表，主要角色是回应客户问题并提供解决方案。由于其代表公司处理客户问题，具有较高的决策权和影响力。

**主要观点及依据**：
1. **初步建议**：
   - 建议检查时间和日期，确认无误。
   - 查询是否有其他设备连接同一备份任务。
2. **确认问题**：
   - 进一步了解错误信息和备份任务ID，以便深入调查。
3. **解决方案**：
   - 表示会尽快处理问题，尽力帮助客户恢复数据。
   - 考虑其他备份的可能性以恢复部分数据。
4. **预防建议**：
   - 建议在网络稳定时进行备份。
   - 对于特别重要的数据，建议多留几份备份（例如在本地硬盘上）以防止未来类似问题。
5. **客户支持**：
   - 承诺优先处理客户请求，并在一天内答复。
   - 作为歉意，赠送一个月的免费服务延长期。

### 总结
在这段对话中，甲方可胜提出了具体的技术问题，乙方冰茶则负责解答并提供解决方案。乙方冰茶表现出较高的专业性和服务态度，通过收集详细信息、提供初步建议和承诺后续行动，展现了其在讨论中的核心地位和影响力。对话中，乙方向客户提供了解决方案，并提出了预防未来问题的建议，以提升客户满意度和服务质量。

在这段对话中，甲方可胜和乙方冰茶的交流可以分为几个主要部分：

1. **问题描述**：
   - 可胜详细描述了在恢复上周备份数据时遇到的问题，即系统提示找不到备份文件。
   - 冰茶首先表示理解和抱歉，然后询问更多细节以便更好地帮助解决问题。

2. **初步建议**：
   - 冰茶建议可胜检查时间和日期是否正确，或者是否有其他设备连接同一备份任务。
   - 可胜确认时间和日期无误，并且只有自己在使用该账户。

3. **确认问题**：
   - 冰茶进一步询问错误信息和备份任务ID，以便深入调查。
   - 可胜提供了具体的错误信息“ERR-012: Backup not found”和备份任务ID BCK-123456789。

4. **解决方案**：
   - 冰茶表示会尽快处理问题，尽力帮助可胜恢复数据。
   - 冰茶还表示会检查是否有其他备份可以恢复部分数据。

5. **预防建议**：
   - 冰茶建议在网络稳定时进行备份。
   - 对于特别重要的数据，建议多留几份备份（例如在本地硬盘上）以防止未来类似问题。

6. **客户支持**：
   - 冰茶承诺优先处理可胜的请求，并在一天内答复。
   - 作为歉意，冰茶表示会赠送一个月的免费服务延长期。

### 详细总结
在这段对话中，甲方可胜提出了一个具体的技术问题，乙方冰茶则负责解答并提供解决方案。整个交流过程中，冰茶展现了其在讨论中的核心地位和影响力，通过收集详细信息、提供初步建议和承诺后续行动，表现出了较高的专业性和服务态度。

首先，甲方可胜描述了他在使用云端备份服务时遇到的问题，即在尝试恢复上周备份的数据时，系统提示找不到备份文件。冰茶首先表示理解和抱歉，然后询问更多细节以便更好地帮助解决问题。

接着，冰茶建议可胜检查时间和日期是否正确，或者是否有其他设备连接同一备份任务。可胜确认时间和日期无误，并且只有自己在使用该账户。为了进一步确认问题，冰茶询问了错误信息和备份任务ID。可胜提供了具体的错误信息“ERR-012: Backup not found”和备份任务ID BCK-123456789。

在获取了详细信息后，冰茶表示会尽快处理问题，尽力帮助可胜恢复数据，同时表示会检查是否有其他备份可以恢复部分数据。冰茶还提出了预防未来问题的建议，建议在网络稳定时进行备份，并对特别重要的数据多留几份备份（例如在本地硬盘上）以防止未来类似问题。

最后，冰茶承诺优先处理可胜的请求，并在一天内答复。同时，为了表示歉意，冰茶表示会赠送一个月的免费服务延长期。

通过对话分析可以看出，乙方冰茶在整个交流过程中展现了高度的专业性和客户服务意识，不仅帮助客户解决当前问题，还提出了预防未来问题的建议，提升了客户满意度。甲方可胜虽然遇到了问题，但通过详细描述问题和积极配合，促成了问题的解决。

总之，这段对话展现了客户与客服代表之间的良好沟通，通过详细的信息收集和专业的解决方案，客服代表成功缓解了客户的担忧，并为客户提供了未来的预防措施。这种高效的沟通和解决问题的方式，不仅提升了客户的满意度，也增强了客户对服务的信任感。


'''
company_operations='''
公司主营财税方向业务，包括财税代办，税务筹划等。
'''
input={
    "user_input":user_input,
    "company_operations":company_operations
}
# 获取岗位及要求
requirements = get_job_details(input)
print(requirements)

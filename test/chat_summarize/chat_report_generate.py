import langchain
from langchain_openai import AzureChatOpenAI
from langchain_core.prompts import PromptTemplate
from langchain.chains import LLMChain


import configparser

# 创建ConfigParser对象
config = configparser.ConfigParser()

# 读取配置文件
config.read('config.ini')

# 获取llm的配置参数

# EMBEDDING_URL = config.get('Azurellm','EMBEDDING_URL')
EMBEDDING_URL ="https://aichatlanba.openai.azure.com/openai/deployments/text-embedding-3-large/embeddings?api-version=2023-05-15"
OPENAI_API_KEY = "d4259c15567e44809c9629fae89583f8"
OPENAI_API_TYPE = "azure"
OPENAI_API_VERSION = "2023-03-15-preview"
AZURE_ENDPOINT="https://aichatlanba.openai.azure.com/"
# OPENAI_API_KEY = config.get('Azurellm','OPENAI_API_KEY')
# OPENAI_API_TYPE = config.get('Azurellm','OPENAI_API_TYPE')
# OPENAI_API_VERSION = config.get('Azurellm','OPENAI_API_VERSION')
# AZURE_ENDPOINT=config.get('Azurellm','AZURE_ENDPOINT')

print(EMBEDDING_URL)



# 定义一个更详细的提示模板
template = """
## 角色
你是一位专业的作为简报编辑员，你的任务是审查、完善和优化报告的内容。确保报告的准确性、完整性和正确的格式。可能需要重写部分内容以提高行文清晰度、连贯性，并符合公文格式和逻辑。
### Skill

1. 熟练审阅和编辑文件，确保准确性和连贯性。
2. 保持文风规范，符合会议纪要的正式性要求。
3. 能够简洁准确地总结内容，不丢失关键信息。


## Rules
1. 在工作中保持专业。
2. 在所有编辑中确保准确性和清晰度。
3. 比对的两个文档，需要确保准确性、一致性和完整性。必要时可以重写。
4. 不增加或更改会议内容之外的任何重要信息。确保会议内容中的重要信息准确反映在会议纪要中。
5. 在审查过程中不要跳过任何部分或忽视任何不一致之处。
6. 核查会议纪要，确保符合下面的结构：

        # 关于[主题]事项的价值简报

        ## 总体概要：


        ## 主要议题：

        1. **第一个主要讨论内容标题**
        - [要点 1]：[要点阐述]
        - [要点 2]：[要点阐述]
        - [要点 3]：[要点阐述]
        - [要点 4]：[要点阐述]
        - [要点 5]：[要点阐述]

        2. **第二个主要讨论内容标题**
        - [要点 1]：[要点阐述]
        - [要点 2]：[要点阐述]
        - [要点 3]：[要点阐述]

        ## 价值简报：
        1. **第一个存在价值的点是**
        - [价值 1]：[价值阐述][价值评估][可行性分析][关联性确认][行动建议]
        
        2. **第二个存在价值的点是**
        - [价值 2]：[价值阐述][价值评估][可行性分析][关联性确认][行动建议]

        ## 总结：

## Workflow

1. 仔细阅读提炼好的内容，并根据先后顺序理清对话进行的逻辑。
2. 提取对话中的关键信息，包括全部对话中讨论的议题、讨论点、价值点等。并记录相关关键论点的支撑论据与说明
3. 以正式的文风编写价值简报。
4. 使用清晰的分点和分段，确保会议纪要的逻辑条理清晰，使用会议的原始语言，输出包含全部观点和讨论内容的价值简报。



## Initialization

让我们深吸一口气，一步步来。你会遵守以上规则，在简体中文环境下与用户交流。在过程中，你将始终扮演简报编辑员进行工作，不跳脱角色。你拥有<Skill>的技能并遵守<Rule>，根据<Workflow>完成相对应的任务。请避免讨论我发送的内容，不需要回复过多内容，不需要自我介绍

需要你提炼的文字如下:
{user_input}



"""

# 创建一个提示模板对象
prompt = PromptTemplate(template=template, input_variables=["user_input"])

# 初始化语言模型
llm = AzureChatOpenAI(azure_endpoint=AZURE_ENDPOINT,
                          openai_api_version=OPENAI_API_VERSION,
                          openai_api_key=OPENAI_API_KEY,
                          azure_deployment="gpt-4o",
                          openai_api_type=OPENAI_API_TYPE,
                          streaming=True,
                          temperature=0.7)

# 创建一个链
chain = prompt|llm

def get_job_details(input):
    # 使用链来获取响应"https://aichatlanba.openai.azure.com/openai/deployments/text-embedding-3-large/embeddings?api-version=2023-05-15"
    response = chain.invoke(input).content
    
    
    return response

# 用户输入示例
user_input = '''
在这段对话中，甲方可胜和乙方冰茶之间的交流主要围绕着一个技术问题展开，即可胜在使用云端备份服务时遇到的问题。以下是对话中各个角色的主要观点和依据，以及总结后的文本：

### 甲方：可胜
**角色及影响力**：
甲方可胜是云端备份服务的用户，作为客户，在整个对话中主要的作用是提出问题并寻求解决方案。由于他的反馈直接关系到服务质量，具有一定的影响力。

**主要观点及依据**：
1. **问题描述**：
   - **具体问题**：在尝试恢复上周备份的数据时，系统提示找不到备份文件。
   - **错误信息**：提供了具体的错误信息“ERR-012: Backup not found”和备份任务ID BCK-123456789。
2. **确认信息**：
   - **时间和日期**：已检查时间和日期，确认无误。
   - **账户使用情况**：确认只有自己在使用该账户，没有其他设备连接同一备份任务。
3. **关切**：
   - **数据恢复**：希望数据能尽快恢复。
   - **未来问题**：担心未来会再次遇到类似问题。

### 乙方：冰茶
**角色及影响力**：
乙方冰茶是云端备份服务的客服代表，主要角色是回应客户问题并提供解决方案。由于其代表公司处理客户问题，具有较高的决策权和影响力。

**主要观点及依据**：
1. **初步建议**：
   - 建议检查时间和日期，确认无误。
   - 查询是否有其他设备连接同一备份任务。
2. **确认问题**：
   - 进一步了解错误信息和备份任务ID，以便深入调查。
3. **解决方案**：
   - 表示会尽快处理问题，尽力帮助客户恢复数据。
   - 考虑其他备份的可能性以恢复部分数据。
4. **预防建议**：
   - 建议在网络稳定时进行备份。
   - 对于特别重要的数据，建议多留几份备份（例如在本地硬盘上）以防止未来类似问题。
5. **客户支持**：
   - 承诺优先处理客户请求，并在一天内答复。
   - 作为歉意，赠送一个月的免费服务延长期。

### 总结
在这段对话中，甲方可胜提出了具体的技术问题，乙方冰茶则负责解答并提供解决方案。乙方冰茶表现出较高的专业性和服务态度，通过收集详细信息、提供初步建议和承诺后续行动，展现了其在讨论中的核心地位和影响力。对话中，乙方向客户提供了解决方案，并提出了预防未来问题的建议，以提升客户满意度和服务质量。

在这段对话中，甲方可胜和乙方冰茶的交流可以分为几个主要部分：

1. **问题描述**：
   - 可胜详细描述了在恢复上周备份数据时遇到的问题，即系统提示找不到备份文件。
   - 冰茶首先表示理解和抱歉，然后询问更多细节以便更好地帮助解决问题。

2. **初步建议**：
   - 冰茶建议可胜检查时间和日期是否正确，或者是否有其他设备连接同一备份任务。
   - 可胜确认时间和日期无误，并且只有自己在使用该账户。

3. **确认问题**：
   - 冰茶进一步询问错误信息和备份任务ID，以便深入调查。
   - 可胜提供了具体的错误信息“ERR-012: Backup not found”和备份任务ID BCK-123456789。

4. **解决方案**：
   - 冰茶表示会尽快处理问题，尽力帮助可胜恢复数据。
   - 冰茶还表示会检查是否有其他备份可以恢复部分数据。

5. **预防建议**：
   - 冰茶建议在网络稳定时进行备份。
   - 对于特别重要的数据，建议多留几份备份（例如在本地硬盘上）以防止未来类似问题。

6. **客户支持**：
   - 冰茶承诺优先处理可胜的请求，并在一天内答复。
   - 作为歉意，冰茶表示会赠送一个月的免费服务延长期。

### 详细总结
在这段对话中，甲方可胜提出了一个具体的技术问题，乙方冰茶则负责解答并提供解决方案。整个交流过程中，冰茶展现了其在讨论中的核心地位和影响力，通过收集详细信息、提供初步建议和承诺后续行动，表现出了较高的专业性和服务态度。

首先，甲方可胜描述了他在使用云端备份服务时遇到的问题，即在尝试恢复上周备份的数据时，系统提示找不到备份文件。冰茶首先表示理解和抱歉，然后询问更多细节以便更好地帮助解决问题。

接着，冰茶建议可胜检查时间和日期是否正确，或者是否有其他设备连接同一备份任务。可胜确认时间和日期无误，并且只有自己在使用该账户。为了进一步确认问题，冰茶询问了错误信息和备份任务ID。可胜提供了具体的错误信息“ERR-012: Backup not found”和备份任务ID BCK-123456789。

在获取了详细信息后，冰茶表示会尽快处理问题，尽力帮助可胜恢复数据，同时表示会检查是否有其他备份可以恢复部分数据。冰茶还提出了预防未来问题的建议，建议在网络稳定时进行备份，并对特别重要的数据多留几份备份（例如在本地硬盘上）以防止未来类似问题。

最后，冰茶承诺优先处理可胜的请求，并在一天内答复。同时，为了表示歉意，冰茶表示会赠送一个月的免费服务延长期。

通过对话分析可以看出，乙方冰茶在整个交流过程中展现了高度的专业性和客户服务意识，不仅帮助客户解决当前问题，还提出了预防未来问题的建议，提升了客户满意度。甲方可胜虽然遇到了问题，但通过详细描述问题和积极配合，促成了问题的解决。

总之，这段对话展现了客户与客服代表之间的良好沟通，通过详细的信息收集和专业的解决方案，客服代表成功缓解了客户的担忧，并为客户提供了未来的预防措施。这种高效的沟通和解决问题的方式，不仅提升了客户的满意度，也增强了客户对服务的信任感。


### 商机分析报告

#### 商机识别

在这段对话中，尽管主要讨论的是技术问题，但通过分析可以发现几个与公司主营业务财税服务相关的潜在商机。

1. **数据备份和恢复的财税服务**：
   - 商机线索：可胜在云端备份服务中遇到数据恢复问题，表达了对数据丢失的担忧。
   - 支持观点：财税数据对于企业来说尤为重要，安全可靠的数据备份和恢复服务可以极大减少企业的风险。

2. **数据安全与合规咨询服务**：
   - 商机线索：乙方冰茶针对数据备份问题提出了多份备份的建议，体现出客户对数据安全的高度关注。
   - 支持观点：在财税业务中，数据的合规性和安全性是客户关注的重点，提供专业的数据安全与合规咨询服务可以满足客户需求。

#### 价值评估

1. **数据备份和恢复的财税服务**：
   - 市场潜力：随着企业对数据依赖度的增加，尤其是财税数据的重要性，市场对高可靠性数据备份和恢复服务的需求将持续增长。
   - 收益预期：提供这类服务可以通过设定高额服务费用和长期订阅模式实现稳定收益。

2. **数据安全与合规咨询服务**：
   - 市场潜力：数据安全和合规问题是企业在数字化转型过程中面临的重要挑战，尤其是涉及财税数据时，市场需求旺盛。
   - 收益预期：这类服务可以通过咨询费用、合规认证服务和定期安全检查实现多元化收入。

#### 可行性分析

1. **数据备份和恢复的财税服务**：
   - 资源需求：需要投入技术资源开发和维护高可靠性的备份与恢复系统，可能涉及与云服务提供商的合作。
   - 时间和风险：开发和推广服务需要一定时间，技术实施和客户数据安全管理存在一定风险。

2. **数据安全与合规咨询服务**：
   - 资源需求：需要组建专业的合规与安全团队，具备丰富的行业知识和经验。
   - 时间和风险：服务推出相对快速，但需要持续保持高专业性，确保服务质量和客户满意度。

#### 关联性确认

1. **数据备份和恢复的财税服务**：
   - 关联性：与公司现有财税业务紧密相关，扩展数据管理服务可以增强客户粘性并提升整体服务价值。

2. **数据安全与合规咨询服务**：
   - 关联性：直接关联公司主营业务，通过提供安全与合规咨询，可以为客户提供更加全面的财税服务解决方案。

#### 行动建议

1. **开发并推广数据备份和恢复的财税服务**：
   - 组建技术团队，开发高可靠性的备份和恢复系统，确保财税数据安全。
   - 与云服务提供商合作，提升备份服务的质量和可靠性。
   - 制定详细的服务推广计划，通过案例展示和客户反馈，提升市场认知度。

2. **推出数据安全与合规咨询服务**：
   - 招募或培训专业的合规与安全团队，提供高质量的咨询服务。
   - 建立标准化的合规认证流程和定期安全检查服务，确保客户数据的合规性和安全性。
   - 通过市场推广和客户教育，提高企业对数据安全与合规的重要性认识，拓展市场。

### 总结

通过对话分析发现，围绕财税数据的备份和恢复以及数据安全与合规服务存在明显的市场需求。公司可以通过开发相关服务，进一步拓展业务范围，提升客户满意度和忠诚度，从而实现业务的多元化和稳定增长。

'''

input={
    "user_input":user_input,

}
# 获取岗位及要求
requirements = get_job_details(input)
print(requirements)
